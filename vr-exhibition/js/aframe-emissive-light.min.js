AFRAME.registerComponent("emissive-light",{schema:{},init:function(){this.createBacklight=this.createBacklight.bind(this),this.getAverageColor=this.getAverageColor.bind(this),this.getPixelData=this.getPixelData.bind(this),this.updateBacklight=this.updateBacklight.bind(this),this.pixelData;const t=document.createElement("canvas");this.context=t.getContext("2d"),this.detail=1,this.backlight=this.createBacklight()},tick:function(){this.updateBacklight()},createBacklight:function(){const t=document.createElement("a-light");return t.setAttribute("position","0 0 -0.1"),t.setAttribute("intensity",".35"),t.setAttribute("angle","-180"),t.setAttribute("distance","20"),t.setAttribute("type","spot"),this.el.appendChild(t),t},updateBacklight:function(){if(this.frame&&this.height&&this.width){const t=this.el.getOrCreateObject3D("mesh").material.map.image,e=this.getPixelData(t),i=this.getAverageColor(e);this.backlight.object3D.children[0].color=i}else{const t=this.el.getOrCreateObject3D("mesh").material;if(t){const e=t.map;if(e){const t=e.image;t&&(this.frame=t,this.height=t.naturalHeight||t.videoHeight,this.width=t.naturalWidth||t.videoWidth)}}}},getAverageColor:function(t){const e=t.data,i=e.length,h={r:0,g:0,b:0};let a=0,s=-4;for(;(s+=4)<i;)++a,h.r+=e[s],h.g+=e[s+1],h.b+=e[s+2];return h.r=~~(h.r/a),h.g=~~(h.g/a),h.b=~~(h.b/a),h},getPixelData:function(t){return this.context.drawImage(t,0,0,this.width,this.height),this.context.getImageData(0,0,this.width,this.height)}});